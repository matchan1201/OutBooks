<%= render "users/users/user",book: @new_book %>
<div class="col-xs-9">
  <h2>Book detail</h2>
  <table class="table table-hover">
    <tbody>
      <tr>
        <td><%= link_to(@book.user) do %>
         <%= attachment_image_tag(@book.user, :profile_image, :fill, 100, 100, fallback: "no-image-icon.jpg") %><br>
          <%= @book.user.name %>
          <% end %>
        </td>
        <td><%= link_to @book.title, @book %></td>
        <td><%= @book.body %></td>
        <td>
        <% if @book.favorited_by?(current_user) %>
          <%= link_to book_favorites_path(@book), method: :delete, remote: true do %>
            <span class="glyphicon glyphicon-heart"><%= @book.favorites.count %></span>
          <% end %>
        <% else %>
          <%= link_to book_favorites_path(@book),method: :post,remote: true do %>
            <span class="glyphicon glyphicon-heart-empty"><%= @book.favorites.count %></span>
          <% end %>
        <% end %>
        </td>
<td>コメント数: <%= @book.book_comments.count %></td>

<% if @book.user == current_user %>
<td><%= link_to 'Edit', edit_book_path(@book), class: "btn-sm btn-success edit_book_#{@book.id}" %></td>
<td><%= link_to 'Destroy', @book, method: :delete, data: { confirm: '本当に消しますか？' }, class: "btn-sm btn-danger destroy_book_#{@book.id}"%></td>
<% end %>
      </tr>
    </tbody>
  </table>
  <% @book_comments.each do |book_comment| %>
  <tr>
    <td>
      <%= link_to user_path(book_comment.user), class: "user_#{book_comment.user.id}" do %>
      <%= attachment_image_tag book_comment.user, :profile_image, :fill, 50, 50, fallback: "no_image.jpg", size: "50x50" %><br>
      <%= book_comment.user.name %>
      <% end %>
    </td>
    <td><%= book_comment.book_comment %></td>
    <% unless current_user != book_comment.user %>
    <td><%= link_to 'Destroy', book_book_comment_path(book_comment.book, book_comment), class: 'btn-sm btn-danger', method: :delete ,remote: true %></td>
    <% end %>
  </tr>
  <% end %>
  <%= form_with model:[@book, @book_comment], url: book_book_comments_path(@book.id), data:{remote: true} do |f| %>
  <% if @book_comment.errors.any? %>
  <h3><%= @book_comment.errors.count %>error occurrence</h3>
  <ul>
    <% book_comment.errors.full_messages.each do |message| %>
    <li><%= message %></li>
    <% end %>
  </ul>
  <% end %>
  <%= f.text_area :book_comment, size: "90x5" , id: "textarea" %>
  <%= f.submit '送信' %>
  <% end %>
</div>